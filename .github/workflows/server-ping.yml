# .github/workflows/keep-oci-alive.yml

name: Keep OCI Server Alive

# When the workflow will run:
on:
  schedule:
    # Runs every 6 hours (at 00:00, 06:00, 12:00, 18:00 UTC)
    # Adjust the frequency based on OCI's specific idle policy if known.
    # Every 6 hours is usually more than enough.
    # Cron syntax generator: https://crontab.guru/
    - cron: '0 */1 * * *'
  workflow_dispatch: # Allows manual triggering from the Actions tab

jobs:
  keep_alive_ping:
    name: Ping OCI Server
    runs-on: ubuntu-latest # Use a standard GitHub-hosted runner

    steps:
      - name: Ping Server Endpoint
        run: |
          echo "Starting ping process at $(date)"
          OCI_SERVER_URL="https://matie.run.place"
          OCI_SERVER_URL_APP="https://matie.run.place/divvy"

          echo "Pinging URL: $OCI_SERVER_URL"
          echo "Pinging URL: $OCI_SERVER_URL_APP"

          # Use curl to send a request:
          # --head: Request only headers, not the full body (efficient)
          # --fail: Make curl exit with an error code if HTTP status is >= 400
          # --show-error: Show error details even with -s (though -s isn't used here)
          # --connect-timeout: Max time in seconds for connection phase
          # --max-time: Max total time in seconds for the entire operation
          curl --head --fail --show-error --connect-timeout 15 --max-time 60 "$OCI_SERVER_URL"
          curl --head --fail --show-error --connect-timeout 15 --max-time 60 "$OCI_SERVER_URL_APP"

          # If curl succeeds (doesn't exit due to --fail), this line will run:
          echo "Ping successful!"

          # If curl fails (e.g., server down, HTTP 4xx/5xx error, timeout),
          # the '--fail' flag will cause this script step to fail,
          # and the GitHub Action run will be marked as failed, notifying you.